(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1259],{43829:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/borrow",function(){return t(2098)}])},2098:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return borrow}});var a=t(35944),o=t(10534),n=t(41664),i=t.n(n),l=t(67294),s=t(52129),d=t(18621),c=t(90629),u=t(93734),m=t(88169),b=t(85893),f=(0,m.Z)((0,b.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2z"}),"Circle"),p=t(88078),h=t(51233),g=t(1048),y=t(32793),v=t(63961),w=t(94780),k=t(70917),x=t(41796),Z=t(98216),C=t(2734),B=t(90948),A=t(71657),S=t(1588),L=t(34867);function getLinearProgressUtilityClass(e){return(0,L.Z)("MuiLinearProgress",e)}(0,S.Z)("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);let M=["className","color","value","valueBuffer","variant"],_=e=>e,P,R,N,V,O,X,q=(0,k.F4)(P||(P=_`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),z=(0,k.F4)(R||(R=_`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),$=(0,k.F4)(N||(N=_`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),useUtilityClasses=e=>{let{classes:r,variant:t,color:a}=e,o={root:["root",`color${(0,Z.Z)(a)}`,t],dashed:["dashed",`dashedColor${(0,Z.Z)(a)}`],bar1:["bar",`barColor${(0,Z.Z)(a)}`,("indeterminate"===t||"query"===t)&&"bar1Indeterminate","determinate"===t&&"bar1Determinate","buffer"===t&&"bar1Buffer"],bar2:["bar","buffer"!==t&&`barColor${(0,Z.Z)(a)}`,"buffer"===t&&`color${(0,Z.Z)(a)}`,("indeterminate"===t||"query"===t)&&"bar2Indeterminate","buffer"===t&&"bar2Buffer"]};return(0,w.Z)(o,getLinearProgressUtilityClass,r)},getColorShade=(e,r)=>"inherit"===r?"currentColor":e.vars?e.vars.palette.LinearProgress[`${r}Bg`]:"light"===e.palette.mode?(0,x.$n)(e.palette[r].main,.62):(0,x._j)(e.palette[r].main,.5),E=(0,B.ZP)("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,r)=>{let{ownerState:t}=e;return[r.root,r[`color${(0,Z.Z)(t.color)}`],r[t.variant]]}})(({ownerState:e,theme:r})=>(0,y.Z)({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:getColorShade(r,e.color)},"inherit"===e.color&&"buffer"!==e.variant&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},"buffer"===e.variant&&{backgroundColor:"transparent"},"query"===e.variant&&{transform:"rotate(180deg)"})),U=(0,B.ZP)("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,r)=>{let{ownerState:t}=e;return[r.dashed,r[`dashedColor${(0,Z.Z)(t.color)}`]]}})(({ownerState:e,theme:r})=>{let t=getColorShade(r,e.color);return(0,y.Z)({position:"absolute",marginTop:0,height:"100%",width:"100%"},"inherit"===e.color&&{opacity:.3},{backgroundImage:`radial-gradient(${t} 0%, ${t} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},(0,k.iv)(V||(V=_`
    animation: ${0} 3s infinite linear;
  `),$)),D=(0,B.ZP)("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,r)=>{let{ownerState:t}=e;return[r.bar,r[`barColor${(0,Z.Z)(t.color)}`],("indeterminate"===t.variant||"query"===t.variant)&&r.bar1Indeterminate,"determinate"===t.variant&&r.bar1Determinate,"buffer"===t.variant&&r.bar1Buffer]}})(({ownerState:e,theme:r})=>(0,y.Z)({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:"inherit"===e.color?"currentColor":(r.vars||r).palette[e.color].main},"determinate"===e.variant&&{transition:"transform .4s linear"},"buffer"===e.variant&&{zIndex:1,transition:"transform .4s linear"}),({ownerState:e})=>("indeterminate"===e.variant||"query"===e.variant)&&(0,k.iv)(O||(O=_`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),q)),I=(0,B.ZP)("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,r)=>{let{ownerState:t}=e;return[r.bar,r[`barColor${(0,Z.Z)(t.color)}`],("indeterminate"===t.variant||"query"===t.variant)&&r.bar2Indeterminate,"buffer"===t.variant&&r.bar2Buffer]}})(({ownerState:e,theme:r})=>(0,y.Z)({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},"buffer"!==e.variant&&{backgroundColor:"inherit"===e.color?"currentColor":(r.vars||r).palette[e.color].main},"inherit"===e.color&&{opacity:.3},"buffer"===e.variant&&{backgroundColor:getColorShade(r,e.color),transition:"transform .4s linear"}),({ownerState:e})=>("indeterminate"===e.variant||"query"===e.variant)&&(0,k.iv)(X||(X=_`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),z)),F=l.forwardRef(function(e,r){let t=(0,A.Z)({props:e,name:"MuiLinearProgress"}),{className:a,color:o="primary",value:n,valueBuffer:i,variant:l="indeterminate"}=t,s=(0,g.Z)(t,M),d=(0,y.Z)({},t,{color:o,variant:l}),c=useUtilityClasses(d),u=(0,C.Z)(),m={},f={bar1:{},bar2:{}};if(("determinate"===l||"buffer"===l)&&void 0!==n){m["aria-valuenow"]=Math.round(n),m["aria-valuemin"]=0,m["aria-valuemax"]=100;let e=n-100;"rtl"===u.direction&&(e=-e),f.bar1.transform=`translateX(${e}%)`}if("buffer"===l&&void 0!==i){let e=(i||0)-100;"rtl"===u.direction&&(e=-e),f.bar2.transform=`translateX(${e}%)`}return(0,b.jsxs)(E,(0,y.Z)({className:(0,v.Z)(c.root,a),ownerState:d,role:"progressbar"},m,{ref:r},s,{children:["buffer"===l?(0,b.jsx)(U,{className:c.dashed,ownerState:d}):null,(0,b.jsx)(D,{className:c.bar1,ownerState:d,style:f.bar1}),"determinate"===l?null:(0,b.jsx)(I,{className:c.bar2,ownerState:d,style:f.bar2})]}))});var T=t(67720),j=t(87357),G=t(82200),J=t(15861),H=t(13371),Y=t(11163),W=t(95201),K=t(45080),MyAccount_AccountBorrowDashboard=e=>{var r,t;let{collateral:n,assets:i,isKYCVerified:l,borrowBalanceCents:s,userTotalSafeBorrowLimitCents:d,toggleAssetCollateral:c}=e,u=(0,H.i)(),m=(0,W.RF)({assets:i}),b=(0,K.RV)({value:d||0,shortenLargeValue:!0}),g=s?(0,K.yo)(s/d*100):"0%",y=(0,K.RV)({value:s,shortenLargeValue:!0,decimals:((null==m?void 0:m.toNumber())||0)>100?0:2}),v=(0,K.RV)({value:Math.abs(null!==(r=null==m?void 0:m.toNumber())&&void 0!==r?r:0),shortenLargeValue:!0,decimals:((null==m?void 0:m.toNumber())||0)>100?0:2}),w=n?(0,K.xH)({value:n.supplyBalance,token:n.token,shortenLargeValue:!0}):"0 OUSG",k=n?(0,K.RV)({value:(0,W.SK)({amountWei:(0,W.SU)({value:n.supplyBalance,token:n.token}),token:n.token,tokenPriceTokens:n.tokenPrice,collateralFactor:n.collateralFactor}).multipliedBy(100),shortenLargeValue:!0}):"0.00",x=(0,a.tZ)(p.Z,{sx:{borderRadius:"4px",width:"3em"}}),Z=void 0===d,C=(0,Y.useRouter)();return(0,a.BX)(h.Z,{direction:{xs:"column",md:"row"},flexWrap:"wrap",mx:"auto",spacing:3,width:"100%",children:[(0,a.BX)(G.Z,{sx:{padding:e=>({xs:4,md:e.spacing(6,7)}),width:"100%",flex:1,background:"#B6AFD7",display:"flex",flexDirection:"column"},children:[(0,a.BX)(J.Z,{variant:"h4",css:u.item,children:[(0,a.tZ)(J.Z,{component:"span",variant:"body2",css:u.labelListItem,children:"Supplied OUSG"}),Z?x:k]}),(0,a.tZ)(J.Z,{variant:"body2",mt:1,children:w}),(0,a.tZ)("div",{style:{flex:1}}),(0,a.BX)(h.Z,{direction:{xs:"column",sm:"row"},alignItems:{xs:"flex-start",sm:"center"},spacing:2,mt:{xs:"32px",md:0},children:[(0,a.tZ)(o.zx,{variant:"primary",onClick:()=>C.push("/borrow?lend=OUSG"),children:"Supply"}),(0,a.tZ)(o.zx,{variant:"tertiary",onClick:()=>C.push("/borrow?lend=OUSG&tab=1"),children:"Withdraw"}),(null==n?void 0:n.collateral)?(0,a.BX)(o.zx,{variant:"primary",onClick:c,children:["Collateral"," ",(0,a.tZ)(f,{sx:{transform:"scale(1.4)",mr:"-.37em",ml:".37em",fontSize:"1.5em",color:"#B6AFD7"}})]}):(0,a.BX)(o.zx,{variant:"tertiary",onClick:c,children:[(0,a.tZ)(f,{sx:{transform:"scale(1.4)",ml:"-.37em",mr:".37em",fontSize:"1.5em"}})," Collateral"]})]})]}),(0,a.BX)(G.Z,{sx:{padding:e=>({xs:4,md:e.spacing(6,7)}),width:"100%",flex:1,background:"#CAD7C6"},children:[(0,a.BX)(J.Z,{variant:"h4",css:u.item,children:[(0,a.tZ)(J.Z,{component:"span",variant:"body2",css:u.labelListItem,children:"Borrow limit"}),Z?x:g," used"]}),(0,a.BX)(J.Z,{variant:"body2",mt:1,children:["of ",Z?x:b," limit"]}),(0,a.tZ)(F,{variant:"determinate",sx:{mt:"32px",borderRadius:"20px",height:"36px",border:"1px solid #000",background:"transparent"},value:s?(s||0)/(d||0)*100:0})]}),(0,a.BX)(G.Z,{sx:{padding:e=>({xs:4,md:e.spacing(6,7)}),width:"100%",flex:1,background:"#D8E3E4",display:"flex",flexDirection:"column"},children:[(0,a.BX)(J.Z,{variant:"h4",css:u.item,flex:1,children:[(0,a.tZ)(J.Z,{component:"span",variant:"body2",css:u.labelListItem,children:"Your total debt"}),Z?x:y]}),(0,a.tZ)("div",{style:{flex:1}}),(0,a.BX)(h.Z,{spacing:.3,mt:{xs:"32px",md:0},children:[(0,a.tZ)(T.Z,{sx:{borderColor:"#000"}}),(0,a.BX)(J.Z,{variant:"body1",children:[(null!==(t=null==m?void 0:m.toNumber())&&void 0!==t?t:0)<0?"Annualized interest expense":"Annualized yearly earnings",(0,a.tZ)(j.Z,{sx:{float:"right"},children:Z?x:v})]}),(0,a.tZ)(T.Z,{sx:{borderColor:"#000"}})]})]})]})},Q=t(95599),ee=t(77343),er=t(68216),et=t(82729);function _templateObject(){let e=(0,et._)(["\n    .table__table-cards__card-content {\n      grid-template-columns: repeat(2, 1fr);\n      grid-template-rows: repeat(2, 1fr);\n    }\n  "]);return _templateObject=function(){return e},e}let useStyles=()=>({cardContentGrid:(0,k.iv)(_templateObject())});var BorrowMarket_BorrowingTable=e=>{let{assets:r,userTotalBorrowLimitCents:t,rowOnClick:n,isLoading:i}=e,{t:s}=(0,ee.$)(),d=(0,er.y)(),c=useStyles(),u={...d,...c},m=(0,Y.useRouter)(),b=(0,l.useMemo)(()=>[{key:"asset",label:s("markets.columns.asset"),orderable:!1,align:"left"},{key:"apy",label:"Asset APY",orderable:!0,align:"right"},{key:"liquidity",label:"Asset Liquidity",orderable:!0,align:"right"},{key:"balance",label:"Your Debt",orderable:!0,align:"right"},{key:"buttons"}],[]),f=r.map(e=>{let{borrowApy:r}=e;return(0,W.Fp)({numerator:+e.borrowBalance.multipliedBy(e.tokenPrice).times(100),denominator:+t}),[{key:"asset",render:()=>(0,a.tZ)(o.SN,{token:e.token}),value:e.token.symbol,align:"left"},{key:"apy",render:()=>(0,a.tZ)(J.Z,{variant:"body1",children:(0,K.yo)(r)}),value:r.toNumber(),align:"right"},{key:"liquidity",render:()=>(0,a.tZ)(J.Z,{variant:"body1",children:(0,K.RV)({value:(e.totalSupplyUsd-e.totalBorrowsUsd)*100,shortenLargeValue:!0})}),value:e.totalSupplyUsd-e.totalBorrowsUsd,align:"right"},{key:"balance",render:()=>(0,a.tZ)(o.zW,{topValue:(0,K.RV)({value:e.borrowBalance.multipliedBy(e.tokenPrice).multipliedBy(100),shortenLargeValue:!0,showDust:!1}),bottomValue:(0,K.xH)({value:e.borrowBalance,token:e.token,shortenLargeValue:!0,minimizeDecimals:!0})}),value:e.borrowBalance.multipliedBy(e.tokenPrice).multipliedBy(100).toNumber(),align:"right"},{key:"buttons",render:()=>(0,a.BX)(h.Z,{sx:{mt:{xs:5,md:0}},direction:"row",spacing:2,justifyContent:"flex-end",children:[e.borrowBalance.gt(0)&&(0,a.tZ)(o.zx,{variant:"tertiary",small:!0,onClick:r=>{r.stopPropagation(),m.push("/borrow?borrow=".concat(e.token.id,"&tab=1"))},children:"Repay"}),(0,a.tZ)(o.zx,{disabled:!n,small:!0,variant:"primary",children:"Borrow"})]}),value:0,align:"right"}]});return(0,a.tZ)(o.iA,{columns:b,data:f,isFetching:i,initialOrder:{orderBy:"apy",orderDirection:"desc"},rowKeyIndex:0,rowOnClick:n,tableCss:d.table,cardsCss:d.cards,css:[d.marketTable,u.cardContentGrid]})},ea=t(70025),eo=t(98682),en=t(71054),ei=t(78404),el=t(95134),es=t(14779),ed=t(44431),ec=t.n(ed),eu=t(58448);let getHypotheticalAccountLiquidity=async e=>{let{accountAddress:r,fTokenAddress:t,fTokenBalanceOfWei:a,fTokenBorrowAmountWei:o=new(ec())(0)}=e,n=await (0,en.a4)({address:(0,ei.CR)("comptroller"),abi:el,functionName:"getHypotheticalAccountLiquidity",args:[r,t,a.toFixed(0),o.toFixed(0)]});return n},useMarkets=e=>{let{address:r}=(0,l.useContext)(u.V),{openSuccessfulTransactionModal:t}=(0,eu.Z)(),[a,n]=(0,l.useState)(void 0),enterMarkets=async e=>{let{fTokenAddresses:r,accountAddress:a,symbol:i}=e,l=o.Am.txWallet();try{let{hash:e}=await (0,en.n9)({address:(0,ei.CR)("comptroller"),abi:el,functionName:"enterMarkets",args:[r]});l(),l=o.Am.txSubmitted(e),await (0,en.Mn)({chainId:1,hash:e}),l(),o.Am.txConfirmed(e),n(void 0),t({title:"Successfully added ".concat(i," as collateral."),transactionHash:e})}catch(r){let e="Error entering markets: ".concat(r);console.error(e),r instanceof es.Jv&&(e=(0,es.iE)(r)),o.Am.error({message:e})}},exitMarket=async e=>{let{fTokenAddress:r,accountAddress:a,symbol:i}=e,l=o.Am.txWallet();try{let{hash:e}=await (0,en.n9)({address:(0,ei.CR)("comptroller"),abi:el,functionName:"exitMarket",args:[r]});l(),l=o.Am.txSubmitted(e),await (0,en.Mn)({chainId:1,hash:e}),l(),o.Am.txConfirmed(e),n(void 0),t({title:"Successfully removed ".concat(i," from collateral."),transactionHash:e})}catch(r){let e="Error exiting market: ".concat(r);console.error(e),r instanceof es.Jv&&(e=(0,es.iE)(r)),o.Am.error({message:e})}},toggleAssetCollateral=async t=>{if(!r)throw new es.Jv({type:"interaction",code:"accountError"});if(!t||!t.borrowBalance.isZero())throw new es.Jv({type:"interaction",code:"collateralRequired"});let a=e.filter(e=>!e.borrowBalance.isZero());if(a.length>0)throw new es.Jv({type:"interaction",code:"collateralRequired"});let o=(0,ei._1)(t.token.id);if(t.collateral)try{let e=await (0,en.EG)({address:r,token:t.token.address}),a=await getHypotheticalAccountLiquidity({accountAddress:r,fTokenAddress:o.address,fTokenBalanceOfWei:(0,W.SU)({value:new(ec())(e.formatted),token:o})});if(a[2]===BigInt(0))return n(t),await exitMarket({fTokenAddress:o.address,accountAddress:r,symbol:t.token.symbol})}catch(e){if(console.error("error",e),e instanceof es.Jv)throw e;throw new es.Jv({type:"interaction",code:"collateralDisableError",data:{assetName:t.token.symbol}})}else try{return n(t),await enterMarkets({fTokenAddresses:[o.address],accountAddress:r,symbol:t.token.symbol})}catch(e){if(e instanceof es.Jv)throw e;throw new es.Jv({type:"interaction",code:"collateralEnableError",data:{assetName:t.token.symbol}})}},collateralOnChange=async e=>{try{await toggleAssetCollateral(e)}catch(r){let e="Error toggling collateral: ".concat(r);console.error(e),r instanceof es.Jv&&(e=(0,es.iE)(r)),o.Am.error({message:e})}};return{collateralOnChange,confirmCollateral:a}};var borrow=()=>{var e,r;let{address:t}=(0,l.useContext)(u.V),n=t||"",{data:{assets:m,userTotalBorrowLimitCents:b,userTotalBorrowBalanceCents:f,userTotalSupplyBalanceCents:p},isLoading:h}=(0,ea.Z)({accountAddress:t}),{kycStatus:g,isLoading:y}=(0,eo.Z)({accountAddress:t}),v=g||!1,w=h||y,{suppliedAssets:k,supplyMarketAssets:x,borrowingAssets:Z,borrowMarketAssets:C}=(0,l.useMemo)(()=>{let e=m.reduce((e,r)=>(e.suppliedAssets.push(r),r.token.id!==c.Wf.ousg.id&&e.borrowingAssets.push(r),e),{suppliedAssets:[],supplyMarketAssets:[],borrowingAssets:[],borrowMarketAssets:[]});return e},[m,w,f,p]),B=(0,Y.useRouter)(),A=null===(e=B.query)||void 0===e?void 0:e.borrow,S=(0,l.useMemo)(()=>[...x,...k].find(e=>{var r;return(null===(r=e.token.id)||void 0===r?void 0:r.toLowerCase())===(null==A?void 0:A.toLowerCase())}),[A,x,k]),L=null===(r=B.query)||void 0===r?void 0:r.lend,M=(0,l.useMemo)(()=>[...x,...k].find(e=>{var r;return(null===(r=e.token.id)||void 0===r?void 0:r.toLowerCase())===(null==L?void 0:L.toLowerCase())}),[L,x,k]),onClose=()=>{let e={...B.query};delete e.borrow,delete e.lend,delete e.tag,delete e.toggle,delete e.tab,B.push({query:e})},P=(0,l.useMemo)(()=>m.find(e=>"OUSG"===e.token.symbol),[m]),{collateralOnChange:R}=useMarkets(Z);return(0,a.BX)(a.HY,{children:[(0,a.tZ)(s.Z,{title:n?"To borrow stablecoins, you'll need to hold some OUSG.":"Connect your wallet to borrow stablecoins",isKYCNotVerified:!v,buttons:n?[(0,a.BX)(o.zx,{variant:"primary",onClick:()=>window.open("https://ondo.finance/ousg"),children:["Buy OUSG ",(0,a.tZ)(d.Z,{width:"24px",height:"24px"})]},"button"),(0,a.tZ)(i(),{href:"/lend",children:(0,a.tZ)(o.zx,{variant:"tertiary",children:"Lend Stablecoins"})},"link")]:void 0,children:(0,a.tZ)(MyAccount_AccountBorrowDashboard,{collateral:P,assets:m,isKYCVerified:v,borrowBalanceCents:+f.toFixed(),userTotalSafeBorrowLimitCents:+b.toFixed(),toggleAssetCollateral:async()=>R(P)})}),(0,a.tZ)(BorrowMarket_BorrowingTable,{assets:Z,userTotalBorrowLimitCents:b,rowOnClick:v?(e,r)=>{if(b.isZero()&&v)return o.Am.error({message:"Please supply OUSG and enable it as collateral to begin borrowing."});let t=r[0].value;B.push({query:{borrow:t}})}:void 0,isLoading:w}),(0,a.BX)(a.HY,{children:[S&&(0,a.tZ)(Q.e,{isKYCVerified:v,asset:S,onClose:onClose}),M&&(0,a.tZ)(Q.s,{isKYCVerified:v,asset:M,assets:[...k,...x],onClose:onClose})]})]})}}},function(e){e.O(0,[56,5072,9090,9774,2888,179],function(){return e(e.s=43829)}),_N_E=e.O()}]);
//# sourceMappingURL=borrow-8e0c9734c45aac5c.js.map